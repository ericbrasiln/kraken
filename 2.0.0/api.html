
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>kraken API &#8212; kraken  documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Models" href="models.html" />
    <link rel="prev" title="Training" href="ketos.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="module-kraken">
<span id="kraken-api"></span><h1>kraken API<a class="headerlink" href="#module-kraken" title="Permalink to this headline">¶</a></h1>
<p>Kraken provides routines which are usable by third party tools. In general
you can expect function in the <code class="docutils literal notranslate"><span class="pre">kraken</span></code> package to remain stable. We will try
to keep these backward compatible, but as kraken is still in an early
development stage and the API is still quite rudimentary nothing can be
garantueed.</p>
<section id="module-kraken.binarization">
<span id="kraken-binarization-module"></span><h2>kraken.binarization module<a class="headerlink" href="#module-kraken.binarization" title="Permalink to this headline">¶</a></h2>
<section id="kraken-binarization">
<h3>kraken.binarization<a class="headerlink" href="#kraken-binarization" title="Permalink to this headline">¶</a></h3>
<p>An adaptive binarization algorithm.</p>
<dl class="py function">
<dt class="sig sig-object py" id="kraken.binarization.nlbin">
<span class="sig-prename descclassname"><span class="pre">kraken.binarization.</span></span><span class="sig-name descname"><span class="pre">nlbin</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">im:</span> <span class="pre">&lt;module</span> <span class="pre">'PIL.Image'</span> <span class="pre">from</span> <span class="pre">'/home/mittagessen/.miniconda3/envs/ta/lib/python3.7/site-packages/PIL/Image.py'&gt;</span></em>, <em class="sig-param"><span class="pre">threshold:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.5</span></em>, <em class="sig-param"><span class="pre">zoom:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.5</span></em>, <em class="sig-param"><span class="pre">escale:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">1.0</span></em>, <em class="sig-param"><span class="pre">border:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.1</span></em>, <em class="sig-param"><span class="pre">perc:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">80</span></em>, <em class="sig-param"><span class="pre">range:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">20</span></em>, <em class="sig-param"><span class="pre">low:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">5</span></em>, <em class="sig-param"><span class="pre">high:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">90</span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">&lt;module</span> <span class="pre">‘PIL.Image’</span> <span class="pre">from</span> <span class="pre">‘/home/mittagessen/.miniconda3/envs/ta/lib/python3.7/site-packages/PIL/Image.py’&gt;</span><a class="headerlink" href="#kraken.binarization.nlbin" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs binarization using non-linear processing.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – </p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – </p></li>
<li><p><strong>zoom</strong> (<em>float</em>) – Zoom for background page estimation</p></li>
<li><p><strong>escale</strong> (<em>float</em>) – Scale for estimating a mask over the text region</p></li>
<li><p><strong>border</strong> (<em>float</em>) – Ignore this much of the border</p></li>
<li><p><strong>perc</strong> (<em>int</em>) – Percentage for filters</p></li>
<li><p><strong>range</strong> (<em>int</em>) – Range for filters</p></li>
<li><p><strong>low</strong> (<em>int</em>) – Percentile for black estimation</p></li>
<li><p><strong>high</strong> (<em>int</em>) – Percentile for white estimation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>PIL.Image containing the binarized image</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>KrakenInputException when trying to binarize an empty image.</strong> – </p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="module-kraken.serialization">
<span id="kraken-serialization-module"></span><h2>kraken.serialization module<a class="headerlink" href="#module-kraken.serialization" title="Permalink to this headline">¶</a></h2>
<dl class="py function">
<dt class="sig sig-object py" id="kraken.serialization.serialize">
<span class="sig-prename descclassname"><span class="pre">kraken.serialization.</span></span><span class="sig-name descname"><span class="pre">serialize</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">records</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#kraken.rpred.ocr_record" title="kraken.rpred.ocr_record"><span class="pre">kraken.rpred.ocr_record</span></a><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">image_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">(0,</span> <span class="pre">0)</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">writing_mode</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'horizontal-tb'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scripts</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">template</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'hocr'</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="headerlink" href="#kraken.serialization.serialize" title="Permalink to this definition">¶</a></dt>
<dd><p>Serializes a list of ocr_records into an output document.</p>
<p>Serializes a list of predictions and their corresponding positions by doing
some hOCR-specific preprocessing and then renders them through one of
several jinja2 templates.</p>
<p>Note: Empty records are ignored for serialization purposes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>records</strong> (<em>iterable</em>) – List of kraken.rpred.ocr_record</p></li>
<li><p><strong>image_name</strong> (<em>str</em>) – Name of the source image</p></li>
<li><p><strong>image_size</strong> (<em>tuple</em>) – Dimensions of the source image</p></li>
<li><p><strong>writing_mode</strong> (<em>str</em>) – Sets the principal layout of lines and the
direction in which blocks progress. Valid values
are horizontal-tb, vertical-rl, and
vertical-lr.</p></li>
<li><p><strong>scripts</strong> (<em>list</em>) – List of scripts contained in the OCR records</p></li>
<li><p><strong>template</strong> (<em>str</em>) – Selector for the serialization format. May be
‘hocr’ or ‘alto’.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(str) rendered template.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-kraken.pageseg">
<span id="kraken-pageseg-module"></span><h2>kraken.pageseg module<a class="headerlink" href="#module-kraken.pageseg" title="Permalink to this headline">¶</a></h2>
<section id="kraken-pageseg">
<h3>kraken.pageseg<a class="headerlink" href="#kraken-pageseg" title="Permalink to this headline">¶</a></h3>
<p>Layout analysis and script detection methods.</p>
<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.detect_scripts">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">detect_scripts</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bounds</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'/tmp/tmp52gjcjox/3b84f0542fa92ceeaad3fe181ed3f19b453a6d05/kraken/script.mlmodel'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">valid_scripts</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.detect_scripts" title="Permalink to this definition">¶</a></dt>
<dd><p>Detects scripts in a segmented page.</p>
<p>Classifies lines returned by the page segmenter into runs of scripts/writing systems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – A bi-level page of mode ‘1’ or ‘L’</p></li>
<li><p><strong>bounds</strong> (<em>dict</em>) – A dictionary containing a ‘boxes’ entry with a list of
coordinates (x0, y0, x1, y1) of a text line in the image
and an entry ‘text_direction’ containing
‘horizontal-lr/rl/vertical-lr/rl’.</p></li>
<li><p><strong>model</strong> (<em>str</em>) – Location of the script classification model or None for default.</p></li>
<li><p><strong>valid_scripts</strong> (<em>list</em>) – List of valid scripts.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True, ‘text_direction’: ‘$dir’, ‘boxes’:
[[(script, (x1, y1, x2, y2)),…]]}: A dictionary containing the text
direction and a list of lists of reading order sorted bounding boxes
under the key ‘boxes’ with each list containing the script segmentation
of a single line. Script is a ISO15924 4 character identifier.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>{‘script_detection’</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><strong>KrakenInvalidModelException if no clstm module is available.</strong> – </p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.pageseg.segment">
<span class="sig-prename descclassname"><span class="pre">kraken.pageseg.</span></span><span class="sig-name descname"><span class="pre">segment</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">im</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">text_direction</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'horizontal-lr'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scale</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">maxcolseps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">black_colseps</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">no_hlines</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">mask</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.pageseg.segment" title="Permalink to this definition">¶</a></dt>
<dd><p>Segments a page into text lines.</p>
<p>Segments a page into text lines and returns the absolute coordinates of
each line in reading order.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>im</strong> (<em>PIL.Image</em>) – A bi-level page of mode ‘1’ or ‘L’</p></li>
<li><p><strong>text_direction</strong> (<em>str</em>) – Principal direction of the text
(horizontal-lr/rl/vertical-lr/rl)</p></li>
<li><p><strong>scale</strong> (<em>float</em>) – Scale of the image</p></li>
<li><p><strong>maxcolseps</strong> (<em>int</em>) – Maximum number of whitespace column separators</p></li>
<li><p><strong>black_colseps</strong> (<em>bool</em>) – Whether column separators are assumed to be
vertical black lines or not</p></li>
<li><p><strong>no_hlines</strong> (<em>bool</em>) – Switch for horizontal line removal</p></li>
<li><p><strong>pad</strong> (<em>int</em><em> or </em><em>tuple</em>) – Padding to add to line bounding boxes. If int the
same padding is used both left and right. If a
2-tuple, uses (padding_left, padding_right).</p></li>
<li><p><strong>mask</strong> (<em>PIL.Image</em>) – A bi-level mask image of the same size as <cite>im</cite> where
0-valued regions are ignored for segmentation
purposes. Disables column detection.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>‘$dir’, ‘boxes’: [(x1, y1, x2, y2),…]}: A
dictionary containing the text direction and a list of reading order
sorted bounding boxes under the key ‘boxes’.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>{‘text_direction’</p>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>KrakenInputException if the input image is not binarized</strong><strong> or </strong><strong>the text</strong> – </p></li>
<li><p><strong>direction is invalid.</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="module-kraken.rpred">
<span id="kraken-rpred-module"></span><h2>kraken.rpred module<a class="headerlink" href="#module-kraken.rpred" title="Permalink to this headline">¶</a></h2>
<section id="kraken-rpred">
<h3>kraken.rpred<a class="headerlink" href="#kraken-rpred" title="Permalink to this headline">¶</a></h3>
<p>Generators for recognition on lines images.</p>
<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.bidi_record">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">bidi_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">record</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#kraken.rpred.ocr_record" title="kraken.rpred.ocr_record"><span class="pre">kraken.rpred.ocr_record</span></a></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#kraken.rpred.ocr_record" title="kraken.rpred.ocr_record"><span class="pre">kraken.rpred.ocr_record</span></a><a class="headerlink" href="#kraken.rpred.bidi_record" title="Permalink to this definition">¶</a></dt>
<dd><p>Reorders a record using the Unicode BiDi algorithm.</p>
<p>Models trained for RTL or mixed scripts still emit classes in LTR order
requiring reordering for proper display.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>record</strong> (<a class="reference internal" href="#kraken.rpred.ocr_record" title="kraken.rpred.ocr_record"><em>kraken.rpred.ocr_record</em></a>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>kraken.rpred.ocr_record</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.mm_rpred">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">mm_rpred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">nets:</span> <span class="pre">Dict[str,</span> <span class="pre">kraken.lib.models.TorchSeqRecognizer],</span> <span class="pre">im:</span> <span class="pre">&lt;module</span> <span class="pre">'PIL.Image'</span> <span class="pre">from</span> <span class="pre">'/home/mittagessen/.miniconda3/envs/ta/lib/python3.7/site-packages/PIL/Image.py'&gt;,</span> <span class="pre">bounds:</span> <span class="pre">dict,</span> <span class="pre">pad:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">16,</span> <span class="pre">bidi_reordering:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True,</span> <span class="pre">script_ignore:</span> <span class="pre">Optional[List[str]]</span> <span class="pre">=</span> <span class="pre">None</span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#kraken.rpred.ocr_record" title="kraken.rpred.ocr_record"><span class="pre">kraken.rpred.ocr_record</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.rpred.mm_rpred" title="Permalink to this definition">¶</a></dt>
<dd><p>Multi-model version of kraken.rpred.rpred.</p>
<p>Takes a dictionary of ISO15924 script identifiers-&gt;models and an
script-annotated segmentation to dynamically select appropriate models for
these lines.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>nets</strong> (<em>dict</em>) – A dict mapping ISO15924 identifiers to TorchSegRecognizer
objects. Recommended to be an defaultdict.</p></li>
<li><p><strong>im</strong> (<em>PIL.Image</em>) – Image to extract text from</p></li>
<li><p><strong>bounds</strong> (<em>dict</em>) – A dictionary containing a ‘boxes’ entry
with a list of lists of coordinates (script, (x0, y0,
x1, y1)) of a text line in the image and an entry
‘text_direction’ containing
‘horizontal-lr/rl/vertical-lr/rl’.</p></li>
<li><p><strong>pad</strong> (<em>int</em>) – Extra blank padding to the left and right of text line</p></li>
<li><p><strong>bidi_reordering</strong> (<em>bool</em>) – Reorder classes in the ocr_record according to
the Unicode bidirectional algorithm for correct
display.</p></li>
<li><p><strong>script_ignore</strong> (<em>list</em>) – List of scripts to ignore during recognition</p></li>
</ul>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>An ocr_record containing the recognized text, absolute character
positions, and confidence values for each character.</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>KrakenInputException if the mapping between segmentation scripts and</strong> – </p></li>
<li><p><strong>networks is incomplete.</strong> – </p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.rpred.ocr_record">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">ocr_record</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">prediction</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">cuts</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">confidences</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.rpred.ocr_record" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A record object containing the recognition result of a single line</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.rpred.rpred">
<span class="sig-prename descclassname"><span class="pre">kraken.rpred.</span></span><span class="sig-name descname"><span class="pre">rpred</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">network:</span> <span class="pre">kraken.lib.models.TorchSeqRecognizer</span></em>, <em class="sig-param"><span class="pre">im:</span> <span class="pre">&lt;module</span> <span class="pre">'PIL.Image'</span> <span class="pre">from</span> <span class="pre">'/home/mittagessen/.miniconda3/envs/ta/lib/python3.7/site-packages/PIL/Image.py'&gt;</span></em>, <em class="sig-param"><span class="pre">bounds:</span> <span class="pre">dict</span></em>, <em class="sig-param"><span class="pre">pad:</span> <span class="pre">int</span> <span class="pre">=</span> <span class="pre">16</span></em>, <em class="sig-param"><span class="pre">bidi_reordering:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Generator</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#kraken.rpred.ocr_record" title="kraken.rpred.ocr_record"><span class="pre">kraken.rpred.ocr_record</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.rpred.rpred" title="Permalink to this definition">¶</a></dt>
<dd><p>Uses a RNN to recognize text</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>network</strong> (<a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer" title="kraken.lib.models.TorchSeqRecognizer"><em>kraken.lib.models.TorchSeqRecognizer</em></a>) – A TorchSegRecognizer
object</p></li>
<li><p><strong>im</strong> (<em>PIL.Image</em>) – Image to extract text from</p></li>
<li><p><strong>bounds</strong> (<em>dict</em>) – A dictionary containing a ‘boxes’ entry with a list of
coordinates (x0, y0, x1, y1) of a text line in the image
and an entry ‘text_direction’ containing
‘horizontal-lr/rl/vertical-lr/rl’.</p></li>
<li><p><strong>pad</strong> (<em>int</em>) – Extra blank padding to the left and right of text line.
Auto-disabled when expected network inputs are incompatible
with padding.</p></li>
<li><p><strong>bidi_reordering</strong> (<em>bool</em>) – Reorder classes in the ocr_record according to
the Unicode bidirectional algorithm for correct
display.</p></li>
</ul>
</dd>
<dt class="field-even">Yields</dt>
<dd class="field-even"><p>An ocr_record containing the recognized text, absolute character
positions, and confidence values for each character.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="module-kraken.transcribe">
<span id="kraken-transcribe-module"></span><h2>kraken.transcribe module<a class="headerlink" href="#module-kraken.transcribe" title="Permalink to this headline">¶</a></h2>
<p>Utility functions for ground truth transcription.</p>
</section>
<section id="kraken-linegen-module">
<h2>kraken.linegen module<a class="headerlink" href="#kraken-linegen-module" title="Permalink to this headline">¶</a></h2>
</section>
<section id="module-kraken.lib.models">
<span id="kraken-lib-models-module"></span><h2>kraken.lib.models module<a class="headerlink" href="#module-kraken.lib.models" title="Permalink to this headline">¶</a></h2>
<section id="kraken-lib-models">
<h3>kraken.lib.models<a class="headerlink" href="#kraken-lib-models" title="Permalink to this headline">¶</a></h3>
<p>Wrapper around TorchVGSLModel including a variety of forward pass helpers for
sequence classification.</p>
<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.lib.models.</span></span><span class="sig-name descname"><span class="pre">TorchSeqRecognizer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">nn</span></em>, <em class="sig-param"><span class="pre">decoder=&lt;function</span> <span class="pre">greedy_decoder&gt;</span></em>, <em class="sig-param"><span class="pre">train:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">False</span></em>, <em class="sig-param"><span class="pre">device:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'cpu'</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>A class wrapping a TorchVGSLModel with a more comfortable recognition interface.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.forward">
<span class="sig-name descname"><span class="pre">forward</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">torch.Tensor</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">numpy.array</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.forward" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (C, H, W)
and returns a numpy array (W, C).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">torch.Tensor</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.predict" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (C, H, W)
and returns the decoding as a list of tuples (string, start, end,
confidence).</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.predict_labels">
<span class="sig-name descname"><span class="pre">predict_labels</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">None._VariableFunctionsClass.tensor</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.predict_labels" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (C, H, W)
and returns a list of tuples (class, start, end, max). Max is the
maximum value of the softmax layer in the region.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.predict_string">
<span class="sig-name descname"><span class="pre">predict_string</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">line</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">torch.Tensor</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.predict_string" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs a forward pass on a torch tensor of a line with shape (C, H, W)
and returns a string of the results.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.models.TorchSeqRecognizer.to">
<span class="sig-name descname"><span class="pre">to</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">device</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.models.TorchSeqRecognizer.to" title="Permalink to this definition">¶</a></dt>
<dd><p>Moves model to device and automatically loads input tensors onto it.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.models.load_any">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.models.</span></span><span class="sig-name descname"><span class="pre">load_any</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fname</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">bool</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'cpu'</span></span></em><span class="sig-paren">)</span> &#x2192; <a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer" title="kraken.lib.models.TorchSeqRecognizer"><span class="pre">kraken.lib.models.TorchSeqRecognizer</span></a><a class="headerlink" href="#kraken.lib.models.load_any" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads anything that was, is, and will be a valid ocropus model and
instantiates a shiny new kraken.lib.lstm.SeqRecognizer from the RNN
configuration in the file.</p>
<p>Currently it recognizes the following kinds of models:</p>
<blockquote>
<div><ul class="simple">
<li><p>pyrnn models containing BIDILSTMs</p></li>
<li><p>protobuf models containing converted python BIDILSTMs</p></li>
<li><p>protobuf models containing CLSTM networks</p></li>
</ul>
</div></blockquote>
<p>Additionally an attribute ‘kind’ will be added to the SeqRecognizer
containing a string representation of the source kind. Current known values
are:</p>
<blockquote>
<div><ul class="simple">
<li><p>pyrnn for pickled BIDILSTMs</p></li>
<li><p>clstm for protobuf models generated by clstm</p></li>
</ul>
</div></blockquote>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>fname</strong> (<em>str</em>) – Path to the model</p></li>
<li><p><strong>train</strong> (<em>bool</em>) – Enables gradient calculation and dropout layers in model.</p></li>
<li><p><strong>device</strong> (<em>str</em>) – Target device</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A kraken.lib.models.TorchSeqRecognizer object.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>
<section id="module-kraken.lib.vgsl">
<span id="kraken-lib-vgsl-module"></span><h2>kraken.lib.vgsl module<a class="headerlink" href="#module-kraken.lib.vgsl" title="Permalink to this headline">¶</a></h2>
<p>VGSL plumbing</p>
<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.lib.vgsl.</span></span><span class="sig-name descname"><span class="pre">TorchVGSLModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">spec</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class building a torch module from a VSGL spec.</p>
<p>The initialized class will contain a variable number of layers and a loss
function. Inputs and outputs are always 4D tensors in order (batch,
channels, height, width) with channels always being the feature dimension.</p>
<p>Importantly this means that a recurrent network will be fed the channel
vector at each step along its time axis, i.e. either put the non-time-axis
dimension into the channels dimension or use a summarizing RNN squashing
the time axis to 1 and putting the output into the channels dimension
respectively.</p>
<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.input">
<span class="sig-name descname"><span class="pre">input</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.input" title="Permalink to this definition">¶</a></dt>
<dd><p>Expected input tensor as a 4-tuple.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>tuple</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.nn">
<span class="sig-name descname"><span class="pre">nn</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.nn" title="Permalink to this definition">¶</a></dt>
<dd><p>Stack of layers parsed from the spec.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>torch.nn.Sequential</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.criterion">
<span class="sig-name descname"><span class="pre">criterion</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.criterion" title="Permalink to this definition">¶</a></dt>
<dd><p>Fully parametrized loss function.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>torch.nn.Module</p>
</dd>
</dl>
</dd></dl>

<dl class="py attribute">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.user_metdata">
<span class="sig-name descname"><span class="pre">user_metdata</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.user_metdata" title="Permalink to this definition">¶</a></dt>
<dd><p>dict with user defined metadata. Is flushed into
model file during saving/overwritten by loading
operations.</p>
<dl class="field-list simple">
<dt class="field-odd">Type</dt>
<dd class="field-odd"><p>dict</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.add_codec">
<span class="sig-name descname"><span class="pre">add_codec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">codec</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><span class="pre">kraken.lib.codec.PytorchCodec</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.add_codec" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a PytorchCodec to the model.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.append">
<span class="sig-name descname"><span class="pre">append</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idx</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">spec</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.append" title="Permalink to this definition">¶</a></dt>
<dd><p>Splits a model at layer <cite>idx</cite> and append layers <cite>spec</cite>.</p>
<p>New layers are initialized using the init_weights method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>idx</strong> (<em>int</em>) – Index of layer to append spec to starting with 1.  To
select the whole layer stack set idx to None.</p></li>
<li><p><strong>spec</strong> (<em>str</em>) – VGSL spec without input block to append to model.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_conv">
<span class="sig-name descname"><span class="pre">build_conv</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_conv" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a 2D convolution layer.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_maxpool">
<span class="sig-name descname"><span class="pre">build_maxpool</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_maxpool" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a maxpool layer.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_output">
<span class="sig-name descname"><span class="pre">build_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds an output layer.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_reshape">
<span class="sig-name descname"><span class="pre">build_reshape</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_reshape" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds a reshape layer</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.build_rnn">
<span class="sig-name descname"><span class="pre">build_rnn</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">input</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span></span></em>, <em class="sig-param"><span class="n"><span class="pre">block</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">,</span> </span><span class="pre">None</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Callable</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.build_rnn" title="Permalink to this definition">¶</a></dt>
<dd><p>Builds an LSTM/GRU layer returning number of outputs and layer.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.eval">
<span class="sig-name descname"><span class="pre">eval</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.eval" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the model to evaluation/inference mode, disabling dropout and
gradient calculation.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.get_layer_name">
<span class="sig-name descname"><span class="pre">get_layer_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.get_layer_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a unique identifier for the layer optionally using a supplied
name.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> (<em>str</em>) – Identifier of the layer type</p></li>
<li><p><strong>name</strong> (<em>str</em>) – user-supplied {name} with {} that need removing.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(str) network unique layer name</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.init_weights">
<span class="sig-name descname"><span class="pre">init_weights</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">idx</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">slice</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">slice(0,</span> <span class="pre">None,</span> <span class="pre">None)</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.init_weights" title="Permalink to this definition">¶</a></dt>
<dd><p>Initializes weights for all or a subset of layers in the graph.</p>
<p>LSTM/GRU layers are orthogonally initialized, convolutional layers
uniformly from (-0.1,0.1).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>idx</strong> (<em>slice</em>) – A slice object representing the indices of layers to
initialize.</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.load_clstm_model">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">load_clstm_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.load_clstm_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads an CLSTM model to VGSL.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.load_model">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">load_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.load_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Deserializes a VGSL model from a CoreML file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – CoreML file</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.load_pronn_model">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">load_pronn_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.load_pronn_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads an pronn model to VGSL.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.load_pyrnn_model">
<em class="property"><span class="pre">classmethod</span> </em><span class="sig-name descname"><span class="pre">load_pyrnn_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.load_pyrnn_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads an pyrnn model to VGSL.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.resize_output">
<span class="sig-name descname"><span class="pre">resize_output</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">del_indices</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">Iterable</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.resize_output" title="Permalink to this definition">¶</a></dt>
<dd><p>Resizes an output linear projection layer.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output_size</strong> (<em>int</em>) – New size of the linear layer</p></li>
<li><p><strong>del_indices</strong> (<em>list</em>) – list of outputs to delete from layer</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.save_model">
<span class="sig-name descname"><span class="pre">save_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">path</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.save_model" title="Permalink to this definition">¶</a></dt>
<dd><p>Serializes the model into path.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>path</strong> (<em>str</em>) – Target destination</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.set_layer_name">
<em class="property"><span class="pre">static</span> </em><span class="sig-name descname"><span class="pre">set_layer_name</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">layer</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">name</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">str</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.set_layer_name" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the name field of an VGSL layer definition.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layer</strong> (<em>str</em>) – VGSL definition</p></li>
<li><p><strong>name</strong> (<em>str</em>) – Layer name</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.set_num_threads">
<span class="sig-name descname"><span class="pre">set_num_threads</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">num</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.set_num_threads" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets number of OpenMP threads to use.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.vgsl.TorchVGSLModel.train">
<span class="sig-name descname"><span class="pre">train</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.vgsl.TorchVGSLModel.train" title="Permalink to this definition">¶</a></dt>
<dd><p>Sets the model to training mode (enables dropout layers and disables
softmax on CTC layers).</p>
</dd></dl>

</dd></dl>

</section>
<section id="module-kraken.lib.codec">
<span id="kraken-lib-codec"></span><h2>kraken.lib.codec<a class="headerlink" href="#module-kraken.lib.codec" title="Permalink to this headline">¶</a></h2>
<p>pytorch compatible codec with many-to-many mapping between labels and
graphemes.</p>
<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.lib.codec.</span></span><span class="sig-name descname"><span class="pre">PytorchCodec</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">charset</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Union</span><span class="p"><span class="pre">[</span></span><span class="pre">Dict</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Translates between labels and graphemes.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.decode">
<span class="sig-name descname"><span class="pre">decode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">labels</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.decode" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes a labelling.</p>
<p>Given a labelling with cuts and  confidences returns a string with the
cuts and confidences aggregated across label-code point
correspondences. When decoding multilabels to code points the resulting
cuts are min/max, confidences are averaged.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>labels</strong> (<em>list</em>) – Input containing tuples (label, start, end,
confidence).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list of tuples (code point, start, end, confidence)</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>list</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">s</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">torch.IntTensor</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Encodes a string into a sequence of labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>s</strong> (<em>str</em>) – Input unicode string</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>(torch.IntTensor) encoded label sequence</p>
</dd>
<dt class="field-odd">Raises</dt>
<dd class="field-odd"><p><strong>KrakenEncodeException if encoding fails.</strong> – </p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.max_label">
<span class="sig-name descname"><span class="pre">max_label</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">int</span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.max_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the maximum label value.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.codec.PytorchCodec.merge">
<span class="sig-name descname"><span class="pre">merge</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">codec</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><span class="pre">kraken.lib.codec.PytorchCodec</span></a></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><span class="pre">kraken.lib.codec.PytorchCodec</span></a><span class="p"><span class="pre">,</span> </span><span class="pre">Set</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.codec.PytorchCodec.merge" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms this codec (c1) into another (c2) reusing as many labels as
possible.</p>
<p>The resulting codec is able to encode the same code point sequences
while not necessarily having the same labels for them as c2.
Retains matching character -&gt; label mappings from both codecs, removes
mappings not c2, and adds mappings not in c1. Compound labels in c2 for
code point sequences not in c1 containing labels also in use in c1 are
added as separate labels.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>codec</strong> (<a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><em>kraken.lib.codec.PytorchCodec</em></a>) – </p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A merged codec and a list of labels that were removed from the
original codec.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="module-kraken.lib.train">
<span id="kraken-lib-train-module"></span><h2>kraken.lib.train module<a class="headerlink" href="#module-kraken.lib.train" title="Permalink to this headline">¶</a></h2>
<p>Training loop interception helpers</p>
<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.EarlyStopping">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">EarlyStopping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">min_delta</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">float</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">lag</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1000</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.EarlyStopping" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">kraken.lib.train.TrainStopper</span></code></p>
<p>Early stopping to terminate training when validation loss doesn’t improve
over a certain time.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.EarlyStopping.trigger">
<span class="sig-name descname"><span class="pre">trigger</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#kraken.lib.train.EarlyStopping.trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that raises a KrakenStopTrainingException after if the abort
condition is fulfilled.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.EarlyStopping.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val_loss</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.train.EarlyStopping.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Updates the internal validation loss state and increases counter by
one.</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.EpochStopping">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">EpochStopping</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.EpochStopping" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">kraken.lib.train.TrainStopper</span></code></p>
<p>Dumb stopping after a fixed number of iterations.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.EpochStopping.trigger">
<span class="sig-name descname"><span class="pre">trigger</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#kraken.lib.train.EpochStopping.trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that raises a KrakenStopTrainingException after if the abort
condition is fulfilled.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.EpochStopping.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val_loss</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.train.EpochStopping.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Only update internal best iteration</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.KrakenTrainer">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">KrakenTrainer</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#kraken.lib.vgsl.TorchVGSLModel" title="kraken.lib.vgsl.TorchVGSLModel"><span class="pre">kraken.lib.vgsl.TorchVGSLModel</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">optimizer</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">torch.optim.optimizer.Optimizer</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">device</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'cpu'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">filename_prefix</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">'model'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">event_frequency</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">1.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">train_set</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><span class="pre">torch.utils.data.dataloader.DataLoader</span><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">stopper</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.KrakenTrainer" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Class encapsulating the training process.</p>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.NoStopping">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">NoStopping</span></span><a class="headerlink" href="#kraken.lib.train.NoStopping" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">kraken.lib.train.TrainStopper</span></code></p>
<p>Never stops training.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.NoStopping.trigger">
<span class="sig-name descname"><span class="pre">trigger</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">bool</span><a class="headerlink" href="#kraken.lib.train.NoStopping.trigger" title="Permalink to this definition">¶</a></dt>
<dd><p>Function that raises a KrakenStopTrainingException after if the abort
condition is fulfilled.</p>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.NoStopping.update">
<span class="sig-name descname"><span class="pre">update</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">val_los</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.train.NoStopping.update" title="Permalink to this definition">¶</a></dt>
<dd><p>Only update internal best iteration</p>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.train.TrainScheduler">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">TrainScheduler</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">optimizer</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">torch.optim.optimizer.Optimizer</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.TrainScheduler" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Implements learning rate scheduling.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.TrainScheduler.add_phase">
<span class="sig-name descname"><span class="pre">add_phase</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">iterations:</span> <span class="pre">int,</span> <span class="pre">lrate:</span> <span class="pre">Tuple[float,</span> <span class="pre">float]</span> <span class="pre">=</span> <span class="pre">(0.0001,</span> <span class="pre">0.0001),</span> <span class="pre">momentum:</span> <span class="pre">Tuple[float,</span> <span class="pre">float]</span> <span class="pre">=</span> <span class="pre">(0.9,</span> <span class="pre">0.9),</span> <span class="pre">wd:</span> <span class="pre">float</span> <span class="pre">=</span> <span class="pre">0.0,</span> <span class="pre">annealing_fn:</span> <span class="pre">Callable[[float,</span> <span class="pre">float,</span> <span class="pre">float],</span> <span class="pre">float]</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">annealing_const&gt;</span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.train.TrainScheduler.add_phase" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a new phase to the scheduler.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sched</strong> (<em>kraken.lib.train.Trainscheduler</em>) – TrainScheduler instance</p></li>
<li><p><strong>epochs</strong> (<em>int</em>) – Number of iterations per cycle</p></li>
<li><p><strong>max_lr</strong> (<em>float</em>) – Peak learning rate</p></li>
<li><p><strong>div</strong> (<em>float</em>) – divisor to determine minimum learning rate (min_lr = max_lr / div)</p></li>
<li><p><strong>max_mon</strong> (<em>float</em>) – Maximum momentum</p></li>
<li><p><strong>min_mon</strong> (<em>float</em>) – Minimum momentum</p></li>
<li><p><strong>wd</strong> (<em>float</em>) – Weight decay</p></li>
<li><p><strong>annealing_fn</strong> (<em>Callable</em><em>[</em><em>[</em><em>int</em><em>, </em><em>int</em><em>, </em><em>int</em><em>]</em><em>, </em><em>float</em><em>]</em>) – LR change</p></li>
<li><p><strong>Can be one of annealing_const</strong> (<em>function.</em>) – </p></li>
<li><p><strong>annealing_linear</strong> (<em>linear change</em>) – change).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.train.TrainScheduler.step">
<span class="sig-name descname"><span class="pre">step</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.train.TrainScheduler.step" title="Permalink to this definition">¶</a></dt>
<dd><p>Performs an optimization step.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.train.add_1cycle">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.train.</span></span><span class="sig-name descname"><span class="pre">add_1cycle</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">sched</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#kraken.lib.train.TrainScheduler" title="kraken.lib.train.TrainScheduler"><span class="pre">kraken.lib.train.TrainScheduler</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">iterations</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_lr</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">div</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">25.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_mom</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.95</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">min_mom</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.85</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">wd</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.train.add_1cycle" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds 1cycle policy [0] phases to a learning rate scheduler.</p>
<p>[0] Smith, Leslie N. “A disciplined approach to neural network hyper-parameters: Part 1–learning rate, batch size, momentum, and weight decay.” arXiv preprint arXiv:1803.09820 (2018).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>sched</strong> (<em>kraken.lib.train.Trainscheduler</em>) – TrainScheduler instance</p></li>
<li><p><strong>iterations</strong> (<em>int</em>) – Number of iterations per cycle</p></li>
<li><p><strong>max_lr</strong> (<em>float</em>) – Peak learning rate</p></li>
<li><p><strong>div</strong> (<em>float</em>) – divisor to determine minimum learning rate (min_lr = max_lr / div)</p></li>
<li><p><strong>max_mon</strong> (<em>float</em>) – Maximum momentum</p></li>
<li><p><strong>min_mon</strong> (<em>float</em>) – Minimum momentum</p></li>
<li><p><strong>wd</strong> (<em>float</em>) – Weight decay</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-kraken.lib.dataset">
<span id="kraken-lib-dataset-module"></span><h2>kraken.lib.dataset module<a class="headerlink" href="#module-kraken.lib.dataset" title="Permalink to this headline">¶</a></h2>
<p>Utility functions for data loading and training of VGSL networks.</p>
<dl class="py class">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset">
<em class="property"><span class="pre">class</span> </em><span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">GroundTruthDataset</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">split:</span> <span class="pre">Callable[[str],</span> <span class="pre">str]</span> <span class="pre">=</span> <span class="pre">&lt;function</span> <span class="pre">GroundTruthDataset.&lt;lambda&gt;&gt;,</span> <span class="pre">suffix:</span> <span class="pre">str</span> <span class="pre">=</span> <span class="pre">'.gt.txt',</span> <span class="pre">normalization:</span> <span class="pre">Optional[str]</span> <span class="pre">=</span> <span class="pre">None,</span> <span class="pre">whitespace_normalization:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True,</span> <span class="pre">reorder:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True,</span> <span class="pre">im_transforms:</span> <span class="pre">Callable[[Any],</span> <span class="pre">torch.Tensor]</span> <span class="pre">=</span> <span class="pre">Compose(</span> <span class="pre">),</span> <span class="pre">preload:</span> <span class="pre">bool</span> <span class="pre">=</span> <span class="pre">True</span></em><span class="sig-paren">)</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">Generic</span></code>[<code class="xref py py-obj docutils literal notranslate"><span class="pre">torch.utils.data.dataset.T_co</span></code>]</p>
<p>Dataset for ground truth used during training.</p>
<p>All data is cached in memory.</p>
<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset.add">
<span class="sig-name descname"><span class="pre">add</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">str</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a line-image-text pair to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>image</strong> (<em>str</em>) – Input image path</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset.add_loaded">
<span class="sig-name descname"><span class="pre">add_loaded</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="pre">image:</span> <span class="pre">&lt;module</span> <span class="pre">'PIL.Image'</span> <span class="pre">from</span> <span class="pre">'/home/mittagessen/.miniconda3/envs/ta/lib/python3.7/site-packages/PIL/Image.py'&gt;</span></em>, <em class="sig-param"><span class="pre">gt:</span> <span class="pre">str</span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset.add_loaded" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds an already loaded  line-image-text pair to the dataset.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>PIL.Image</em>) – Line image</p></li>
<li><p><strong>gt</strong> (<em>str</em>) – Text contained in the line image</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="kraken.lib.dataset.GroundTruthDataset.encode">
<span class="sig-name descname"><span class="pre">encode</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">codec</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Optional</span><span class="p"><span class="pre">[</span></span><a class="reference internal" href="#kraken.lib.codec.PytorchCodec" title="kraken.lib.codec.PytorchCodec"><span class="pre">kraken.lib.codec.PytorchCodec</span></a><span class="p"><span class="pre">]</span></span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">None</span><a class="headerlink" href="#kraken.lib.dataset.GroundTruthDataset.encode" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a codec to the dataset and encodes all text lines.</p>
<p>Has to be run before sampling from the dataset.</p>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.compute_error">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">compute_error</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">model</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer" title="kraken.lib.models.TorchSeqRecognizer"><span class="pre">kraken.lib.models.TorchSeqRecognizer</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_set</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">Sequence</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">str</span><span class="p"><span class="pre">,</span> </span><span class="pre">str</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.dataset.compute_error" title="Permalink to this definition">¶</a></dt>
<dd><p>Computes error report from a model and a list of line image-text pairs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>model</strong> (<a class="reference internal" href="#kraken.lib.models.TorchSeqRecognizer" title="kraken.lib.models.TorchSeqRecognizer"><em>kraken.lib.models.TorchSeqRecognizer</em></a>) – Model used for recognition</p></li>
<li><p><strong>validation_set</strong> (<em>list</em>) – List of tuples (image, text) for validation</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A tuple with total number of characters and edit distance across the
whole validation set.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.dataset.generate_input_transforms">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.dataset.</span></span><span class="sig-name descname"><span class="pre">generate_input_transforms</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">batch</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pad</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">torchvision.transforms.transforms.Compose</span><a class="headerlink" href="#kraken.lib.dataset.generate_input_transforms" title="Permalink to this definition">¶</a></dt>
<dd><p>Generates a torchvision transformation converting a PIL.Image into a
tensor usable in a network forward pass.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>batch</strong> (<em>int</em>) – mini-batch size</p></li>
<li><p><strong>height</strong> (<em>int</em>) – height of input image in pixels</p></li>
<li><p><strong>width</strong> (<em>int</em>) – width of input image in pixels</p></li>
<li><p><strong>channels</strong> (<em>int</em>) – color channels of input</p></li>
<li><p><strong>pad</strong> (<em>int</em>) – Amount of padding on horizontal ends of image</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A torchvision transformation composition converting the input image to
the appropriate tensor.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="module-kraken.lib.ctc_decoder">
<span id="kraken-lib-ctc-decoder"></span><h2>kraken.lib.ctc_decoder<a class="headerlink" href="#module-kraken.lib.ctc_decoder" title="Permalink to this headline">¶</a></h2>
<p>Decoders for softmax outputs of CTC trained networks.</p>
<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.ctc_decoder.beam_decoder">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.ctc_decoder.</span></span><span class="sig-name descname"><span class="pre">beam_decoder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">beam_size</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">int</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">3</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.ctc_decoder.beam_decoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates back the network output to a label sequence using
same-prefix-merge beam search decoding as described in [0].</p>
<p>[0] Hannun, Awni Y., et al. “First-pass large vocabulary continuous speech
recognition using bi-directional recurrent DNNs.” arXiv preprint
arXiv:1408.2873 (2014).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>output</strong> (<em>numpy.array</em>) – (C, W) shaped softmax output tensor</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list with tuples (class, start, end, prob). max is the maximum value
of the softmax layer in the region.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.ctc_decoder.blank_threshold_decoder">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.ctc_decoder.</span></span><span class="sig-name descname"><span class="pre">blank_threshold_decoder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">float</span></span> <span class="o"><span class="pre">=</span></span> <span class="default_value"><span class="pre">0.5</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.ctc_decoder.blank_threshold_decoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates back the network output to a label sequence as the original
ocropy/clstm.</p>
<p>Thresholds on class 0, then assigns the maximum (non-zero) class to each
region.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>output</strong> (<em>numpy.array</em>) – (C, W) shaped softmax output tensor</p></li>
<li><p><strong>threshold</strong> (<em>float</em>) – Threshold for 0 class when determining possible
label locations.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list with tuples (class, start, end, max). max is the maximum value
of the softmax layer in the region.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="kraken.lib.ctc_decoder.greedy_decoder">
<span class="sig-prename descclassname"><span class="pre">kraken.lib.ctc_decoder.</span></span><span class="sig-name descname"><span class="pre">greedy_decoder</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">outputs</span></span><span class="p"><span class="pre">:</span></span> <span class="n"><span class="pre">numpy.ndarray</span></span></em><span class="sig-paren">)</span> &#x2192; <span class="pre">List</span><span class="p"><span class="pre">[</span></span><span class="pre">Tuple</span><span class="p"><span class="pre">[</span></span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">int</span><span class="p"><span class="pre">,</span> </span><span class="pre">float</span><span class="p"><span class="pre">]</span></span><span class="p"><span class="pre">]</span></span><a class="headerlink" href="#kraken.lib.ctc_decoder.greedy_decoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Translates back the network output to a label sequence using greedy/best
path decoding as described in [0].</p>
<p>[0] Graves, Alex, et al. “Connectionist temporal classification: labelling
unsegmented sequence data with recurrent neural networks.” Proceedings of
the 23rd international conference on Machine learning. ACM, 2006.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>output</strong> (<em>numpy.array</em>) – (C, W) shaped softmax output tensor</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>A list with tuples (class, start, end, max). max is the maximum value
of the softmax layer in the region.</p>
</dd>
</dl>
</dd></dl>

</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/kraken.png" alt="Logo"/>
            </a></p>
  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">kraken API</a><ul>
<li><a class="reference internal" href="#module-kraken.binarization">kraken.binarization module</a><ul>
<li><a class="reference internal" href="#kraken-binarization">kraken.binarization</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-kraken.serialization">kraken.serialization module</a></li>
<li><a class="reference internal" href="#module-kraken.pageseg">kraken.pageseg module</a><ul>
<li><a class="reference internal" href="#kraken-pageseg">kraken.pageseg</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-kraken.rpred">kraken.rpred module</a><ul>
<li><a class="reference internal" href="#kraken-rpred">kraken.rpred</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-kraken.transcribe">kraken.transcribe module</a></li>
<li><a class="reference internal" href="#kraken-linegen-module">kraken.linegen module</a></li>
<li><a class="reference internal" href="#module-kraken.lib.models">kraken.lib.models module</a><ul>
<li><a class="reference internal" href="#kraken-lib-models">kraken.lib.models</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-kraken.lib.vgsl">kraken.lib.vgsl module</a></li>
<li><a class="reference internal" href="#module-kraken.lib.codec">kraken.lib.codec</a></li>
<li><a class="reference internal" href="#module-kraken.lib.train">kraken.lib.train module</a></li>
<li><a class="reference internal" href="#module-kraken.lib.dataset">kraken.lib.dataset module</a></li>
<li><a class="reference internal" href="#module-kraken.lib.ctc_decoder">kraken.lib.ctc_decoder</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="ketos.html" title="previous chapter">Training</a></li>
      <li>Next: <a href="models.html" title="next chapter">Models</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
<h3>Versions</h3>
<ul>
  <li><a href="api.html">2.0.0</a></li>
  <li><a href="../3.0/api.html">3.0</a></li>
  <li><a href="../master/api.html">master</a></li>
</ul>


        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2015, mittagessen.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/api.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>